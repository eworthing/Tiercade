# AI Coding Assistant Instructions

This file provides instructions for AI coding assistants (Codex, Aider, Continue, etc.)

## Quick Start: Build & Run

**Primary Workflow: VS Code task "Build, Install & Launch tvOS" (Cmd+Shift+B)**

This runs `./build_install_launch.sh` which:
- Always performs a clean build (forces fresh compilation)
- Shows progress: üßπ Cleaning ‚Üí üî® Building ‚Üí üì¶ Installing ‚Üí üöÄ Launching
- Displays actual build timestamp for verification
- Boots simulator, uninstalls old version, installs fresh build, launches app

## Critical Build Information

‚ö†Ô∏è **IMPORTANT**: Xcode builds to `~/Library/Developer/Xcode/DerivedData/`, NOT `./build/`

**The build script (`./build_install_launch.sh`):**
1. Cleans to force fresh compilation every time
2. Builds with correct tvOS simulator destination
3. Queries xcodebuild for actual BUILT_PRODUCTS_DIR in DerivedData
4. Verifies app exists at that location
5. Shows build timestamp
6. Installs from correct DerivedData location
7. Launches app

**Manual build (if needed):**
```bash
./build_install_launch.sh

# Or direct xcodebuild:
xcodebuild clean -project Tiercade.xcodeproj -scheme Tiercade -configuration Debug
xcodebuild -project Tiercade.xcodeproj -scheme Tiercade \
  -destination 'platform=tvOS Simulator,name=Apple TV 4K (3rd generation),OS=latest' \
  -configuration Debug build
```

## Project Architecture

- **Platform**: tvOS 26+ (primary), iOS 26+, macOS 26+
- **Language**: Swift 6 with strict concurrency enabled
- **UI**: SwiftUI only
- **State**: @Observable pattern with @MainActor
- **Structure**:
  - `Tiercade/` - Main app (tvOS/iOS/macOS)
  - `TiercadeCore/` - Platform-agnostic Swift package
  - `Tiercade/State/AppState.swift` - Central state with extensions
  - `Tiercade/Views/` - Organized by purpose (Main, Overlays, Toolbar, Components)
  - `Tiercade/Design/` - Design tokens (Palette, TypeScale, Metrics, TVMetrics)

## Development Patterns

### State Management
- Central `@Observable` class: `AppState.swift`
- Feature extensions: `AppState+*.swift` (Persistence, Export, Import, Items, etc.)
- Flow: View ‚Üí AppState method ‚Üí TiercadeCore logic ‚Üí state update ‚Üí SwiftUI refresh
- Never mutate `tiers` or `selection` directly in views

### Design Tokens
Always use design tokens instead of hardcoding:
- Colors: `Palette.primary`, `Palette.tierS`, etc.
- Typography: `TypeScale.h1`, `TypeScale.body`, etc.
- Spacing: `Metrics.padding`, `TVMetrics.topBarHeight`, etc.

### tvOS Focus Management
- Overlays use `.focusSection()` and `.focusable(interactions: .activate)`
- Keep background interactive with `.allowsHitTesting(!overlayActive)` (never `.disabled()`)
- Accessibility IDs: `{Component}_{Action}` pattern on leaf elements only

### Testing
- **Unit tests**: `cd TiercadeCore && swift test`
- **Framework**: Swift Testing (`@Test`, `#expect`) for new tests
- **UI tests**: Use accessibility identifiers, avoid long XCUIRemote navigation

## Asset Management

Fetch bundled images from TMDb:
```bash
export TMDB_API_KEY='your-key'
./tools/fetch_bundled_images.sh
```

See `tools/README_IMAGES.md` for details.

## Complete Documentation

For comprehensive instructions, see:
- `.github/copilot-instructions.md` - Full AI agent playbook
- `CLAUDE.md` - Claude-specific instructions
- `.cursorrules` - Cursor AI rules
- `README.md` - User-facing documentation
