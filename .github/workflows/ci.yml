name: CI

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  swiftlint:
    name: SwiftLint
    runs-on: macos-15
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install SwiftLint
        run: brew install swiftlint
      
      - name: Run SwiftLint
        run: swiftlint lint --strict

  test-core:
    name: Test TiercadeCore
    runs-on: macos-15
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Run package tests
        run: |
          cd TiercadeCore
          swift test

  build-tvos:
    name: Build tvOS
    runs-on: macos-15
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Build tvOS target
        run: |
          xcodebuild clean build \
            -project Tiercade.xcodeproj \
            -scheme Tiercade \
            -destination 'platform=tvOS Simulator,name=Apple TV 4K (3rd generation),OS=latest' \
            CODE_SIGNING_ALLOWED=NO

  build-macos:
    name: Build macOS
    runs-on: macos-15
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Build macOS target
        run: |
          xcodebuild clean build \
            -project Tiercade.xcodeproj \
            -scheme Tiercade \
            -destination 'platform=macOS' \
            CODE_SIGNING_ALLOWED=NO
